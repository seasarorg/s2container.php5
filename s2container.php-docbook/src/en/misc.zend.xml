<sect1 id="misc.zend"><title>Using S2Container with Zend_Controller</title>
    <sect2><title>Environment</title>
        <itemizedlist>
            <listitem>PHP-5.3.0</listitem>
            <listitem>Zend Framework v1.8.4</listitem>
            <listitem>s2container.php-2.0.1</listitem>
        </itemizedlist>
    </sect2>

    <sbr/>
    <sect2><title>Creation of the project</title>
        <para>
          Let's make the project directory by using Zend_Tool_Framework.
          Afterwards, the setting to use s2container.php is added. 
          In the following SVN repository, there is a project directory made this time. 
        </para>

        <itemizedlist>
            <listitem><ulink url="https://www.seasar.org/svn/s2container.php5/trunk/s2zf184/">https://www.seasar.org/svn/s2container.php5/trunk/s2zf184/</ulink></listitem>
        </itemizedlist>
    </sect2>

  <sbr/>
  <sect2><title>Setup of S2Container</title>
    <para>
      Let's add the setting to use s2container.php for the project made with Zend_Tool_Framework.
    </para>

       <blockquote><formalpara><title>Preparing the s2.php</title><sbr/></formalpara>
            <para>
            Create the s2.php which is a setting file of s2container.php in the application/configs directory. 
            </para>
            <itemizedlist>
                <listitem><ulink url="https://www.seasar.org/svn/s2container.php5/trunk/s2zf184/application/configs/s2.php">application/configs/s2.php</ulink></listitem>
            </itemizedlist>
       </blockquote>

       <sbr/>
       <blockquote><formalpara><title>Creation of S2ActionHelper</title><sbr/></formalpara>
            <para>
               Make the action helper which accesses S2Container in the action method.
            </para>
            <itemizedlist>
                <listitem><ulink url="https://www.seasar.org/svn/s2container.php5/trunk/s2zf184/library/Seasar/Zf/Controller/S2ActionHelper.php">library/Seasar/Zf/Controller/S2ActionHelper.php</ulink></listitem>
            </itemizedlist>
       </blockquote>

       <sbr/>
       <blockquote><formalpara><title>Edit of Bootstrap.php</title><sbr/></formalpara>
            <para>
              Set the use of S2ActionHelper with Bootstrap of the application.(_initActionHelper method)
            </para>
            <itemizedlist>
                <listitem><ulink url="https://www.seasar.org/svn/s2container.php5/trunk/s2zf184/application/Bootstrap.php">application/Bootstrap.php</ulink></listitem>
            </itemizedlist>
       </blockquote>

       <sbr/>
       <blockquote><formalpara><title>Creation of var directory</title><sbr/></formalpara>
            <para>
              Make the var directory to save the log file, the session file, and cash, etc.
            </para>
            <itemizedlist>
                <listitem><ulink url="https://www.seasar.org/svn/s2container.php5/trunk/s2zf184/var/">var/</ulink></listitem>
            </itemizedlist>
       </blockquote>
  </sect2>

  <sbr/>
  <sect2><title>Using S2Container in the Action method</title>
    <para>
        When using  the component of S2Container in the action method, you can touch it by the S2ActionHelper.
    </para>
      <itemizedlist>
        <listitem><ulink url="https://www.seasar.org/svn/s2container.php5/trunk/s2zf184/application/controllers/IndexController.php">application/controllers/IndexController.php</ulink></listitem>
      </itemizedlist>
<programlisting continuation="restart" linenumbering="unnumbered"><![CDATA[
    public function cdListAction()
    {
        $this->view->dtos = $this->_helper->s2('Service_SampleService')->findAllCd();
    }
]]></programlisting>
    <para>
        Let's create the <ulink url="https://www.seasar.org/svn/s2container.php5/trunk/s2zf184/application/services/SampleService.php">Service_SampleService class</ulink> int the application/services directory.
        Because the setter method for the <ulink url="https://www.seasar.org/svn/s2container.php5/trunk/s2zf184/application/models/DbTable/Cd.php">Model_DbTable_Cd class</ulink> is defined in the Service_SampleService class,
        the instance of the Model_DbTable_Cd class is injected by the automatic injection function of S2Container.
        The Model_DbTable_Cd class is a model which extends Zend_Db_Table accessing <ulink url="https://www.seasar.org/svn/s2container.php5/trunk/s2zf184/var/db/">var/db/sqlite.db</ulink> database. 
    </para>

    <para>
    The access from in the method of the action to S2Container can be accessed by way of the property of S2ActionHelper. The name specified for a property becomes a component name. 
    </para>

      <itemizedlist>
        <listitem><ulink url="https://www.seasar.org/svn/s2container.php5/trunk/s2zf184/application/controllers/IndexController.php">application/controllers/IndexController.php</ulink></listitem>
      </itemizedlist>
<programlisting continuation="restart" linenumbering="unnumbered"><![CDATA[
    public function cdList2Action()
    {
        $this->view->dtos = $this->_helper->s2->service2->findAllCd();
    }
]]></programlisting>

    <para>
    For the above-mentioned, the component of the name "service2" is taken out from S2Container.
    However, when the component is taken from S2Container by the component name, it is necessary to register the component in S2Container in advance. 
    S2ActionHelper can read the configuration file to construct S2Container in each action.
    The configuration file is located in "module/dicons/controller/action.php"
    The following file becomes the configuration file of the cdList2 action for the above-mentioned.
    </para>

    <itemizedlist>
        <listitem><ulink url="https://www.seasar.org/svn/s2container.php5/trunk/s2zf184/application/dicons/index/cd-list2.php">application/dicons/index/cd-list2.php</ulink></listitem>
    </itemizedlist>
  </sect2>

  <sbr/>
  <sect2><title>UnitTest of The Component</title>
    <para>
      Let's create the UnitTest in the tests direcotry.
      The bootstrap method of Zend_Application is executed with <ulink url="https://www.seasar.org/svn/s2container.php5/trunk/s2zf184/tests/application/bootstrap.php">tests/application/bootstrap.php</ulink>, and the applications environment is constructed.
      Create UnitTest of the Service_SampleService class in the <ulink url="https://www.seasar.org/svn/s2container.php5/trunk/s2zf184/tests/application/services/">tests/application/services directory</ulink> as <ulink url="https://www.seasar.org/svn/s2container.php5/trunk/s2zf184/tests/application/services/SampleServiceTest.php">SampleServiceTest.php</ulink>. 
      In the Service_SampleServiceTest class, the service component to be tested is acquired from S2Contaienrã€€in the setUp method 
    </para>

<programlisting continuation="restart" linenumbering="unnumbered"><![CDATA[
    public function setUp() {
        s2app::init();
        $this->service = s2app::get('Service_SampleService');
    }
]]></programlisting>

    <para>
    The execution result of UnitTest is as follows.
    </para>

<programlisting continuation="restart" linenumbering="unnumbered"><![CDATA[
% cd tests
% cat phpunit.xml
<phpunit bootstrap="application/bootstrap.php"/>
% phpunit application
PHPUnit 3.3.17 by Sebastian Bergmann.

....

Time: 0 seconds

OK (4 tests, 4 assertions)
%
]]></programlisting>

  </sect2>
</sect1>

